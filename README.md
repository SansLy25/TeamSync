# TeamSync

Сервис для поиска тимейтов

Люди играющие в многопользовательские игры сталкиваются с проблемой поиска союзников (тимейтов) для игры вместе, наш
сервис призван помочь в поиске

Дополнительная документация находится в файле `EXTENSION.md` (по расширению для REST API), `DEV.md` (документация по
разработке этого проекта) и `frontend/FRONTEND.md` (объяснение фронтенда)
Для понимания кода и того как взаимодействуют сервисы все эти файлы рекомендуются к прочтению

# Распределение обязанностей

Сутидзе Александр: Создавал заявки и лобби (модели, схемы, эндпоинты) на бэкенде (каталоги /lobbies и /bids), делал
презентацию, тестирование
Степанов Роберт: Проектирование и создание архитектуры, бэкенд (кроме каталогов /lobbies и /bids), весь фронтенд,
конфигурация docker и docker compose, конфигурация Nginx, деплой, написание документации

# Инструкция по запуску

Запуск возможен в двух режимах: `dev` и `production`
(через docker (технология контейнеризации)), 1 способ сложнее, но быстрее в плане
запуска сервера (важно тк при разработке он часто
перезапускается), и медленнее в плане обработки запросов
запускает только API, но дополнительно нужно
установить PostgreSQL на пк. Второй способ нужен
для запуска в условиях реального сервера, для него
нужно установить только docker, остальное (PostgreSQL,
Nginx) docker сам подтянет с образов. Для проверки проекта лучше использовать способ через docker.

## Запуск в production mode

### 1. Установка и запуск Docker и Docker-compose

Для Windows:

1. Скачайте Docker Desktop с сайта: https://www.docker.com/products/docker-desktop
2. Запустите установочный файл и следуйте инструкциям установщика
3. После установки Docker Desktop должен сам запуститься, если этого не произошло то надо найти через поиск в меню Пуск
   `docker` и запустить вручную

Для Linux:

```bush
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

### 2. Запуск контейнеров

Перейдите в корень проекта (на один уровень с README.md) с помощью `cd`

```bush
docker-compose up --build
```

После этого сайт будет доступен по адресу http://localhost (документация API по http://localhost/api/docs), а логи БД,
Nginx, фронтенда и API будут появляться в терминале,

# Архитектура

Архитектура была выбрана монолитная с четким разделением на бэкенд и фронтенд, мы отказались от шаблонизации (тк этот
подход устарел и почти не используется в современных серьезных проектах) в пользу современного подхода взаимодействия
бэкенда и фронтенда через REST API, вот схема взаимодействия сервисов:

![](images/architecture.png)

### Описание сервисов

- `Flask`: REST API, использует http и json как формат передачи данных, в качестве сервера используется Guvicorn
- `Node.js + React`: фронтенд с современным подходом
- `PostgreSQL`: Самая популярная БД на данный момент в продакшен среде, в разы быстрее SQLite, имеет в разы больший
  функционал
- `Nginx`: обратный прокси и сервер статики, перенаправляет запросы с префиксом /api/ на бэкенд сервер, а с префиксом /
  на фронтенд

# Подход к бэкенд разработке (свое расширение)

Так как мы выбрали тяжелый путь REST, а Flask это не REST фреймворк (да есть расширение flask-restfull, но оно не дает
средств для проектирования API а просто переносит принцип REST во flask, но сам процесс разработки почти такой же как и
на обычном Flask) то мы решили создать свое расширение которое упростит разработку API и превратит Flask в нормальный
REST фреймворк

##### Функции расширения

1. Автоматическая валидация через Pydantic (как при запросе так и при ответе)
2. Автоматическое создание (с возможностью дополнения) openapi документации на основе системы типов и сигнатур функций
3. Просмотр документации в сгенерированном SwaggerUI
4. Легко встраиваемая аутентификация через JWT токен
5. Перевод API исключений в REST формат
6. Возможность возврата ответа в функции представления в разном виде

При создании расширения опирались на концепции фреймворка FastAPI, который считается самым популярным python фреймворком
для создания API, получилось очень похоже, подробную документацию к расширению можно почитать в файле `EXTENSION.md`

##### Можно **уверенно

** заявить что созданное расширение может существовать как самостоятельный проект независимо от этого и
переиспользоваться
**бесконечное количество раз**

## P.S

Эту часть особо к существующим .md файлам не отнести, поэтому она здесь

### Тестирование API

Чтобы протестировать API нужно зайти на `/api/docs`, после
этого вы увидите интерфейс Swagger (интерактивной
документации), помимо просмотром описания эндпоинтов, параметров, схем ответа и запрос, сами запросы можно выполнять
прямо в Swagger (для некоторых эндпоинтов авторизоваться, на эту тему дальше), для этого нужно раскрыть нужно вам эндпоинт и нажать на кнопку `Try it out`, после этого вы сможете
ввести параметры запроса (если они есть) и нажать `Execute`, после этого вы увидите ответ от API, его код, заголовки и
тело ответа

Некоторые эндпоинты требуют авторизации, например `/api/profile`, авторизация осуществляется через JWT токены (токен
который генерируется на основе данных пользователя и передается в заголовке Authorization), чтобы идентифицировать
пользователя, фронтенд сам подставляет полученный входе регистрации или входа токен, но при тестировании надо сделать
это вручную

Как это сделать ?

1. Зайти на `/api/docs`
2. Найти эндпоинт `/api/signup` и раскрыть его
3. Ввести валидные данные пользователя (валидный url для аватара или null, правильный пароль и тд) и выполнить запрос
4. Если код ответа 400, это значит что ваши данные невалидны, посмотрите на сообщение (msg) в теле ответа,
   отредактируйте данные и выполните запрос заново, если код ответа 200, то все прошло успешноВ теле ответа найти token
   и скопировать его значение без кавычек,
5. Нажать кнопку Authorize в правом верхнем углу и вставить скопированный токен в поле
6. Теперь Swagger сам будет подставлять ваш токен в заголовок, чтобы проверить корректно ли вы скопировали токен можно выполнить защищенный эндпоинт например `/api/profile`, если вы все сделали правильно то
   получите ответ 200, если нет то 401 (Unauthorized) значит вы неправильно скопировали токен или он истек, или его нет в заголовке